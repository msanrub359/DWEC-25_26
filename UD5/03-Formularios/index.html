<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario Pro - Validación Moderna</title>
<style>
  body { font-family: system-ui, sans-serif; padding: 2rem; background: #f8f9fa; }
  form { max-width: 420px; margin: auto; background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .field { margin-bottom: 1.2rem; }
  label { display: block; margin-bottom: 0.3rem; font-weight: 500; }
  input { width: 100%; padding: 0.6rem; border: 1px solid #ccc; border-radius: 6px; transition: border-color 0.2s; }
  input:focus { border-color: #007bff; outline: none; }
  input.error { border-color: red; }
  span.error { color: red; font-size: 0.9rem; display: block; min-height: 1.2em; margin-top: 0.2rem; }
  button { width: 100%; padding: 0.8rem; border: none; border-radius: 6px; background: #007bff; color: white; font-weight: 600; cursor: pointer; transition: background 0.2s; }
  button:disabled { background: #aaa; cursor: not-allowed; }
  button:not(:disabled):hover { background: #0056d2; }
  #success { color: green; margin-top: 1rem; font-weight: 600; text-align: center; }
</style>
</head>
<body>

<h2 style="text-align:center; margin-bottom:1rem;">Formulario Moderno Pro</h2>

<form id="miFormulario" novalidate>
  <div class="field">
    <label for="nombre">Nombre</label>
    <input type="text" id="nombre" name="nombre" required minlength="3">
    <span class="error" aria-live="polite"></span>
  </div>
  <div class="field">
    <label for="email">Email</label>
    <input type="email" id="email" name="email" required>
    <span class="error" aria-live="polite"></span>
  </div>
  <div class="field">
    <label for="password">Contraseña</label>
    <input type="password" id="password" name="password" required minlength="6">
    <span class="error" aria-live="polite"></span>
  </div>
  <button type="submit" disabled>Enviar</button>
</form>

<div id="success" aria-live="polite"></div>

<script>
  const form = document.querySelector("#miFormulario");
  const submitBtn = form.querySelector("button[type='submit']");
  const successMsg = document.querySelector("#success");

  const validators = {
    nombre: val => val.trim().length >= 3 ? "" : "El nombre debe tener al menos 3 caracteres",
    email: val => /\S+@\S+\.\S+/.test(val) ? "" : "Email inválido",
    password: val => val.length >= 6 ? "" : "La contraseña debe tener al menos 6 caracteres"
  };

  // Debounce utility: espera a que el usuario deje de escribir
  const debounce = (fn, delay = 400) => {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => fn(...args), delay);
    };
  };

  function validateField(field) {
    const errorText = validators[field.name]?.(field.value) || "";
    const errorEl = field.nextElementSibling;
    errorEl.textContent = errorText;
    field.classList.toggle("error", !!errorText);
    return !errorText;
  }

  // Validación en tiempo real (con debounce)
  const handleInput = debounce((e) => {
    const field = e.target;
    if (field.tagName !== "INPUT") return;
    validateField(field);
    toggleSubmitButton();
  });

  // Validación al perder foco
  const handleBlur = (e) => {
    const field = e.target;
    if (field.tagName !== "INPUT") return;
    validateField(field);
    toggleSubmitButton();
  };

  function toggleSubmitButton() {
    const valid = Array.from(form.elements)
      .filter(el => el.tagName === "INPUT")
      .every(el => !validators[el.name](el.value));
    submitBtn.disabled = !valid;
  }

  form.addEventListener("input", handleInput);
  form.addEventListener("blur", handleBlur, true);

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    let allValid = true;
    Array.from(form.elements).forEach(el => {
      if (el.tagName === "INPUT") {
        if (!validateField(el)) allValid = false;
      }
    });
    if (!allValid) return;

    successMsg.textContent = "✅ ¡Formulario enviado con éxito!";
    form.reset();
    submitBtn.disabled = true;
  });
</script>

</body>
</html>
